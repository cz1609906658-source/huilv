<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>多功能计算器 - 汇率转换、费用计算与储蓄规划</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(rgba(0, 0, 0, 0.6), rgba(0, 0, 0, 0.6)), 
                        url('https://w.wallhaven.cc/full/qr/wallhaven-qr27rq.jpg') no-repeat center center fixed;
            background-size: cover;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 20px;
            color: white;
            padding: 20px 20px 0 20px;
        }
        
        .header h1 {
            font-size: 2.8rem;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        
        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
            max-width: 700px;
            margin: 0 auto;
        }
        
        .tabs-nav {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 30px;
            background: rgba(0, 0, 0, 0.2);
            padding: 10px;
            border-radius: 12px;
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
            max-width: 300px;
            margin-left: auto;
            margin-right: auto;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .tab-button {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            flex-grow: 1;
            text-align: center;
        }

        .tab-button:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .tab-button.active {
            background: rgba(255, 255, 255, 0.9);
            color: #212529;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        .main-container {
            display: flex;
            justify-content: center;
            align-items: flex-start;
            flex-grow: 1;
            width: 100%;
        }

        .tab-content {
            display: none;
            width: 100%;
            max-width: 450px;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .calculator-container {
            width: 100%;
        }
        
        .card {
            background: rgba(255, 255, 255, 0.92);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            padding: 25px;
            height: 100%;
            transition: transform 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-5px);
        }
        
        .card-header {
            text-align: center;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }
        
        .card-icon {
            background: #4361ee;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.2rem;
        }
        
        .card-title {
            font-size: 24px;
            color: #212529;
            font-weight: 700;
        }
        
        .card-subtitle {
            font-size: 13px;
            color: #6c757d;
        }
        
        .input-group {
            margin-bottom: 15px;
        }
        
        .input-label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            color: #212529;
            font-size: 14px;
        }
        
        .input-container {
            position: relative;
        }
        
        .input-field {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            font-size: 14px;
            transition: all 0.3s ease;
            background: white;
        }
        
        .input-field:focus {
            border-color: #4895ef;
            outline: none;
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
        }
        
        .select-field {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            font-size: 14px;
            background: white;
            appearance: none;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .select-field:focus {
            border-color: #4895ef;
            outline: none;
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
        }
        
        .select-icon {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            pointer-events: none;
            font-size: 12px;
        }
        
        .swap-container {
            display: flex;
            justify-content: center;
            margin: 12px 0;
        }
        
        .swap-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #4361ee;
            color: white;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(67, 97, 238, 0.3);
        }
        
        .swap-btn:hover {
            background: #3f37c9;
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(67, 97, 238, 0.4);
        }
        
        .swap-btn:active {
            transform: translateY(0);
        }
        
        .result-container {
            background: rgba(72, 149, 239, 0.1);
            border-radius: 12px;
            padding: 15px;
            margin-top: 15px;
            text-align: center;
            transition: all 0.3s ease;
        }
        
        .result-value {
            font-size: 26px;
            font-weight: 700;
            color: #4361ee;
            margin: 8px 0;
        }
        
        .result-label {
            font-size: 13px;
            color: #6c757d;
        }
        
        .action-buttons {
            display: flex;
            gap: 12px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 120px;
        }
        
        .btn-primary {
            background: #4361ee;
            color: white;
            box-shadow: 0 4px 10px rgba(67, 97, 238, 0.3);
        }
        
        .btn-primary:hover {
            background: #3f37c9;
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(67, 97, 238, 0.4);
        }
        
        .btn-primary:active {
            transform: translateY(0);
        }
        
        .btn-secondary {
            background: white;
            color: #4361ee;
            border: 2px solid #4361ee;
        }
        
        .btn-secondary:hover {
            background: rgba(67, 97, 238, 0.1);
        }
        
        .btn-icon {
            margin-right: 6px;
            font-size: 14px;
        }
        
        .last-updated {
            text-align: center;
            margin-top: 12px;
            font-size: 12px;
            color: #6c757d;
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 8px;
        }
        
        .loading-spinner {
            border: 3px solid rgba(67, 97, 238, 0.2);
            border-top: 3px solid #4361ee;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            animation: spin 1s linear infinite;
            margin: 0 auto 8px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .error-message, .detailed-result .error {
            color: #dc3545;
            text-align: center;
            margin-top: 8px;
            font-size: 13px;
        }

        .detailed-result .error {
            background-color: #ffeaea;
            padding: 10px;
            border-radius: 4px;
        }
        
        .footer {
            text-align: center;
            color: white;
            padding: 25px;
            margin-top: auto;
            font-size: 0.9rem;
            opacity: 0.8;
        }
        
        .detailed-result {
            margin-top: 20px;
            padding: 15px;
            border: 1px dashed #ccc;
            border-radius: 12px;
            background-color: #f9f9f9;
            text-align: left;
        }
        
        .detailed-result h3 {
            margin-bottom: 10px;
            color: #212529;
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
        }
        
        .detailed-result p {
            margin: 8px 0;
        }

        .detailed-result .highlight {
            color: #e74c3c;
            font-size: 1.1rem;
            font-weight: 700;
        }
        
        .detailed-result small {
            display: block;
            margin-top: 10px;
            font-size: 12px;
            color: #6c757d;
        }
        
        /* 储蓄计算器特定样式 */
        .savings-mode-selector {
            display: flex;
            background: #f8f9fa;
            border-radius: 8px;
            overflow: hidden;
            margin-bottom: 20px;
        }
        
        .savings-mode-btn {
            flex: 1;
            padding: 12px;
            text-align: center;
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
            background: rgba(0, 0, 0, 0.05);
        }
        
        .savings-mode-btn:hover {
            background: rgba(0, 0, 0, 0.08);
        }
        
        .savings-mode-btn.active {
            background: white;
            border-bottom: 3px solid #4361ee;
            color: #4361ee;
        }
        
        .savings-result-card {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .savings-result-value {
            font-size: 2rem;
            font-weight: 700;
            color: #4361ee;
            margin: 10px 0;
        }
        
        .savings-result-label {
            font-size: 1rem;
            color: #7f8c8d;
        }
        
        .savings-progress-container {
            margin: 20px 0;
        }
        
        .savings-progress-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 0.9rem;
            color: #7f8c8d;
        }
        
        .savings-progress-bar {
            height: 16px;
            background: #ecf0f1;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .savings-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4361ee, #4895ef);
            border-radius: 8px;
            transition: width 0.8s ease;
        }
        
        .savings-chart-container {
            height: 250px;
            margin-top: 25px;
        }
        
        .savings-summary {
            background: #e8f4fc;
            border-radius: 12px;
            padding: 15px;
            margin-top: 20px;
        }
        
        .savings-summary-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #d6eaf8;
            font-size: 0.9rem;
        }
        
        .savings-summary-item:last-child {
            border-bottom: none;
        }
        
        .savings-highlight {
            font-weight: 600;
            color: #212529;
        }
        
        .savings-frequency-selector {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .savings-frequency-btn {
            flex: 1;
            padding: 10px;
            text-align: center;
            border: 1px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.85rem;
        }
        
        .savings-frequency-btn.active {
            background: #4361ee;
            color: white;
            border-color: #4361ee;
        }
        
        /* 响应式设计 */
        @media (max-width: 576px) {
            .tabs-nav {
                max-width: 95%;
            }
            .tab-button {
                padding: 8px 10px;
                font-size: 0.9rem;
            }
            .header h1 {
                font-size: 2.2rem;
            }
            .action-buttons {
                flex-direction: column;
            }
            .savings-mode-selector {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <h1><i class="fas fa-calculator"></i> 多功能计算器</h1>
        <p>汇率转换、费用计算与储蓄规划一站式解决方案</p>
    </header>

    <nav class="tabs-nav">
        <button class="tab-button active" data-tab="exchange">汇率转换</button>
        <button class="tab-button" data-tab="cost">费用计算</button>
        <button class="tab-button" data-tab="savings">储蓄计算</button>
    </nav>
    
    <main class="main-container">

        <section id="exchange" class="tab-content active">
            <div class="calculator-container">
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon">
                            <i class="fas fa-exchange-alt"></i>
                        </div>
                        <div>
                            <h2 class="card-title">汇率转换器</h2>
                            <p class="card-subtitle">实时汇率转换工具</p>
                        </div>
                    </div>
                    
                    <div class="input-group">
                        <label class="input-label" for="amount">金额</label>
                        <div class="input-container">
                            <input type="number" class="input-field" id="amount" placeholder="请输入金额" value="">
                        </div>
                    </div>
                    
                    <div class="input-group">
                        <label class="input-label" for="fromCurrency">从</label>
                        <div class="input-container">
                            <select class="select-field" id="fromCurrency">
                                <option value="CNY" selected>人民币 (CNY)</option>
                                <option value="USD">美元 (USD)</option>
                                <option value="EUR">欧元 (EUR)</option>
                                <option value="GBP">英镑 (GBP)</option>
                                <option value="JPY">日元 (JPY)</option>
                                <option value="CAD">加元 (CAD)</option>
                                <option value="AUD">澳元 (AUD)</option>
                                <option value="CHF">瑞士法郎 (CHF)</option>
                                <option value="HKD">港币 (HKD)</option>
                                <option value="KRW">韩元 (KRW)</option>
                                <option value="TWD">新台币 (TWD)</option>
                                <option value="SGD">新加坡元 (SGD)</option>
                                <option value="THB">泰铢 (THB)</option>
                            </select>
                            <span class="select-icon">▼</span>
                        </div>
                    </div>
                    
                    <div class="swap-container">
                        <button class="swap-btn" id="swapBtn" aria-label="交换货币">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M16 17L20 21M20 21L16 25M20 21H4M8 7L4 3M4 3L8 -1M4 3H20" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </button>
                    </div>
                    
                    <div class="input-group">
                        <label class="input-label" for="toCurrency">到</label>
                        <div class="input-container">
                            <select class="select-field" id="toCurrency">
                                <option value="USD" selected>美元 (USD)</option>
                                <option value="CNY">人民币 (CNY)</option>
                                <option value="EUR">欧元 (EUR)</option>
                                <option value="GBP">英镑 (GBP)</option>
                                <option value="JPY">日元 (JPY)</option>
                                <option value="CAD">加元 (CAD)</option>
                                <option value="AUD">澳元 (AUD)</option>
                                <option value="CHF">瑞士法郎 (CHF)</option>
                                <option value="HKD">港币 (HKD)</option>
                                <option value="KRW">韩元 (KRW)</option>
                                <option value="TWD">新台币 (TWD)</option>
                                <option value="SGD">新加坡元 (SGD)</option>
                                <option value="THB">泰铢 (THB)</option>
                            </select>
                            <span class="select-icon">▼</span>
                        </div>
                    </div>
                    
                    <div class="result-container">
                        <div class="result-label">转换结果</div>
                        <div class="result-value" id="result">0.00</div>
                    </div>
                    
                    <div class="error-message" id="errorMessage"></div>
                    
                    <div class="loading" id="loading">
                        <div class="loading-spinner"></div>
                        <div>正在获取最新汇率...</div>
                    </div>
                    
                    <div class="action-buttons">
                        <button class="btn btn-primary" id="convertBtn">
                            <i class="fas fa-sync-alt btn-icon"></i>
                            转换货币
                        </button>
                        <button class="btn btn-secondary" id="refreshBtn">
                            <i class="fas fa-redo btn-icon"></i>
                            刷新汇率
                        </button>
                    </div>
                    
                    <div class="last-updated" id="lastUpdated">
                        最后更新: <span id="updateTime">正在获取...</span>
                    </div>
                </div>
            </div>
        </section>

        <section id="cost" class="tab-content">
             <div class="calculator-container">
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon">
                            <i class="fas fa-calendar-alt"></i>
                        </div>
                        <div>
                            <h2 class="card-title">费用计算器</h2>
                            <p class="card-subtitle">根据周期费用计算可用时长</p>
                        </div>
                    </div>
                    
                    <div class="input-group">
                        <label class="input-label" for="cost-calc-total-amount">总金额（元）</label>
                        <div class="input-container">
                            <input type="number" class="input-field" id="cost-calc-total-amount" placeholder="请输入总金额" step="0.01" min="0.01">
                        </div>
                    </div>

                    <div class="input-group">
                        <label class="input-label" for="cost-calc-unit-cost">单位费用（元）</label>
                        <div class="input-container">
                            <input type="number" class="input-field" id="cost-calc-unit-cost" placeholder="请输入单位费用" step="0.01" min="0.01">
                        </div>
                    </div>
                    
                    <div class="input-group">
                        <label class="input-label" for="cost-calc-time-unit">时间单位</label>
                        <div class="input-container">
                            <select class="select-field" id="cost-calc-time-unit">
                                <option value="hour">每小时</option>
                                <option value="day">每天</option>
                                <option value="month" selected>每月</option>
                                <option value="year">每年</option>
                            </select>
                            <span class="select-icon">▼</span>
                        </div>
                    </div>
                    
                    <div class="input-group">
                        <label class="input-label" for="cost-calc-start-date">开始使用日期 (可选)</label>
                        <div class="input-container">
                            <input type="date" class="input-field" id="cost-calc-start-date">
                        </div>
                    </div>
                    
                    <div class="action-buttons">
                        <button class="btn btn-primary" id="cost-calc-button">
                            <i class="fas fa-calculator btn-icon"></i>
                            计算使用情况
                        </button>
                    </div>
                    
                    <div id="cost-calc-result" class="detailed-result"></div>
                </div>
            </div>
        </section>

        <section id="savings" class="tab-content">
            <div class="calculator-container">
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon">
                            <i class="fas fa-piggy-bank"></i>
                        </div>
                        <div>
                            <h2 class="card-title">储蓄计算器</h2>
                            <p class="card-subtitle">规划您的储蓄目标</p>
                        </div>
                    </div>
                    
                    <div id="savings-calc-app">
                        <div class="savings-mode-selector">
                            <div 
                                class="savings-mode-btn" 
                                :class="{active: currentMode === 'target'}"
                                @click="currentMode = 'target'">
                                存钱买什么？
                            </div>
                            <div 
                                class="savings-mode-btn" 
                                :class="{active: currentMode === 'amount'}"
                                @click="currentMode = 'amount'">
                                能存下多少？
                            </div>
                            <div 
                                class="savings-mode-btn" 
                                :class="{active: currentMode === 'time'}"
                                @click="currentMode = 'time'">
                                需要存多久？
                            </div>
                        </div>
                        
                        <div v-if="currentMode === 'target'">
                            <div class="input-group">
                                <label class="input-label" for="savings-targetAmount">目标金额（元）</label>
                                <div class="input-container">
                                    <input 
                                        type="number" 
                                        class="input-field" 
                                        id="savings-targetAmount" 
                                        v-model.number="targetAmount" 
                                        placeholder="请输入目标金额，例如：50000"
                                        min="0">
                                </div>
                            </div>
                            
                            <div class="input-group">
                                <label class="input-label" for="savings-targetTime">计划完成时间</label>
                                <div class="input-container">
                                    <input 
                                        type="number" 
                                        class="input-field" 
                                        id="savings-targetTime" 
                                        v-model.number="timeValue" 
                                        placeholder="请输入时间数值，例如：12"
                                        min="1">
                                    <select class="select-field" v-model="timeUnit" style="margin-top: 10px;">
                                        <option value="months">月</option>
                                        <option value="years">年</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div v-if="currentMode === 'amount'">
                            <div class="input-group">
                                <label class="input-label" for="savings-monthlyDeposit">每月存款金额（元）</label>
                                <div class="input-container">
                                    <input 
                                        type="number" 
                                        class="input-field" 
                                        id="savings-monthlyDeposit" 
                                        v-model.number="monthlyDeposit" 
                                        placeholder="请输入每月存款金额，例如：2000"
                                        min="0">
                                </div>
                            </div>
                            
                            <div class="input-group">
                                <label class="input-label" for="savings-timeValue">计划储蓄时间</label>
                                <div class="input-container">
                                    <input 
                                        type="number" 
                                        class="input-field" 
                                        id="savings-timeValue" 
                                        v-model.number="timeValue" 
                                        placeholder="请输入时间数值，例如：24"
                                        min="1">
                                    <select class="select-field" v-model="timeUnit" style="margin-top: 10px;">
                                        <option value="months">月</option>
                                        <option value="years">年</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div v-if="currentMode === 'time'">
                            <div class="input-group">
                                <label class="input-label" for="savings-timeTargetAmount">目标金额（元）</label>
                                <div class="input-container">
                                    <input 
                                        type="number" 
                                        class="input-field" 
                                        id="savings-timeTargetAmount" 
                                        v-model.number="targetAmount" 
                                        placeholder="请输入目标金额，例如：30000"
                                        min="0">
                                </div>
                            </div>
                            
                            <div class="input-group">
                                <label class="input-label" for="savings-monthlyDepositTime">每月存款金额（元）</label>
                                <div class="input-container">
                                    <input 
                                        type="number" 
                                        class="input-field" 
                                        id="savings-monthlyDepositTime" 
                                        v-model.number="monthlyDeposit" 
                                        placeholder="请输入每月存款金额，例如：1500"
                                        min="0">
                                </div>
                            </div>
                        </div>
                        
                        <div class="input-group">
                            <label class="input-label" for="savings-initialAmount">初始金额（可选）</label>
                            <div class="input-container">
                                <input 
                                    type="number" 
                                    class="input-field" 
                                    id="savings-initialAmount" 
                                    v-model.number="initialAmount" 
                                    placeholder="请输入初始存款金额，例如：5000"
                                    min="0">
                            </div>
                        </div>
                        
                        <div class="input-group">
                            <label class="input-label">存款频率</label>
                            <div class="savings-frequency-selector">
                                <div 
                                    class="savings-frequency-btn" 
                                    :class="{active: frequency === 'monthly'}"
                                    @click="frequency = 'monthly'">
                                    每月
                                </div>
                                <div 
                                    class="savings-frequency-btn" 
                                    :class="{active: frequency === 'weekly'}"
                                    @click="frequency = 'weekly'">
                                    每周
                                </div>
                                <div 
                                    class="savings-frequency-btn" 
                                    :class="{active: frequency === 'yearly'}"
                                    @click="frequency = 'yearly'">
                                    每年
                                </div>
                            </div>
                        </div>
                        
                        <div class="savings-result-card">
                            <div class="savings-result-label">您的储蓄计划</div>
                            
                            <div v-if="currentMode === 'target'">
                                <div class="savings-result-value">{{ formatCurrency(requiredMonthlyDeposit) }}</div>
                                <div class="savings-result-label">每月需要存款金额</div>
                                <div v-if="['weekly', 'yearly'].includes(frequency)" style="margin-top: 10px;">
                                    按{{ frequency === 'weekly' ? '每周' : '每年' }}存款: 
                                    <strong>{{ formatCurrency(frequencyAmount) }}</strong>
                                </div>
                            </div>
                            
                            <div v-if="currentMode === 'amount'">
                                <div class="savings-result-value">{{ formatCurrency(totalAmount) }}</div>
                                <div class="savings-result-label">到期总金额</div>
                            </div>
                            
                            <div v-if="currentMode === 'time'">
                                <div class="savings-result-value">{{ requiredMonths }}</div>
                                <div class="savings-result-label">需要存款月数</div>
                                <div v-if="requiredMonths > 0" style="margin-top: 10px;">
                                    约 {{ Math.floor(requiredMonths / 12) }} 年 {{ requiredMonths % 12 }} 个月
                                </div>
                            </div>
                        </div>
                        
                        <div class="savings-progress-container">
                            <div class="savings-progress-header">
                                <span>当前进度</span>
                                <span>{{ progressPercentage }}%</span>
                            </div>
                            <div class="savings-progress-bar">
                                <div 
                                    class="savings-progress-fill" 
                                    :style="{width: progressPercentage + '%'}">
                                </div>
                            </div>
                        </div>
                        
                        <div class="savings-chart-container">
                            <canvas id="savingsChart"></canvas>
                        </div>
                        
                        <div class="savings-summary">
                            <div class="savings-summary-item">
                                <span>目标金额:</span>
                                <span class="savings-highlight">{{ formatCurrency(targetAmount) }}</span>
                            </div>
                            <div class="savings-summary-item">
                                <span>初始金额:</span>
                                <span>{{ formatCurrency(initialAmount) }}</span>
                            </div>
                            <div class="savings-summary-item">
                                <span>每月存款:</span>
                                <span>{{ formatCurrency(monthlyDeposit) }}</span>
                            </div>
                            <div class="savings-summary-item">
                                <span>存款频率:</span>
                                <span>{{ frequencyText }}</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

    </main>
    
    <footer class="footer">
        <p>© 2025 多功能计算器 | 实时汇率与费用计算工具</p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // =================================================================
            // Tab Navigation
            // =================================================================
            const tabs = document.querySelectorAll('.tab-button');
            const tabContents = document.querySelectorAll('.tab-content');
            
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const targetId = tab.dataset.tab;
                    tabs.forEach(t => t.classList.remove('active'));
                    tabContents.forEach(c => c.classList.remove('active'));
                    tab.classList.add('active');
                    document.getElementById(targetId).classList.add('active');
                    
                    // 如果切换到储蓄计算器标签，更新图表
                    if (targetId === 'savings' && savingsVueInstance && savingsVueInstance.savingsChart) {
                        setTimeout(() => {
                            savingsVueInstance.savingsChart.update();
                        }, 300);
                    }
                });
            });

            // =================================================================
            // 汇率转换器
            // =================================================================
            const amountInput = document.getElementById('amount');
            const fromCurrency = document.getElementById('fromCurrency');
            const toCurrency = document.getElementById('toCurrency');
            const resultElement = document.getElementById('result');
            const convertBtn = document.getElementById('convertBtn');
            const refreshBtn = document.getElementById('refreshBtn');
            const swapBtn = document.getElementById('swapBtn');
            const updateTime = document.getElementById('updateTime');
            const loadingElement = document.getElementById('loading');
            const errorMessage = document.getElementById('errorMessage');
            let exchangeRates = {};

            async function fetchExchangeRates() {
                showLoading(true); hideError();
                const apiKey = '959ec28f8bf8c08f160ff7a2'; 
                const url = `https://v6.exchangerate-api.com/v6/${apiKey}/latest/USD`;
                try {
                    const response = await fetch(url);
                    if (!response.ok) throw new Error(`网络响应错误: ${response.statusText}`);
                    const data = await response.json();
                    if (data.result === 'success') {
                        exchangeRates = data.conversion_rates;
                        if (updateTime) updateTime.textContent = new Date(data.time_last_update_utc).toLocaleString('zh-CN');
                        if (amountInput.value) convertCurrency();
                    } else {
                        let apiError = data['error-type'] || '未知API错误';
                        if (apiError === 'invalid-key') apiError = 'API密钥无效或错误';
                        else if (apiError === 'inactive-account') apiError = 'API账户未激活';
                        throw new Error(apiError);
                    }
                } catch (error) { showError(`无法获取最新汇率: ${error.message}`);
                } finally { showLoading(false); }
            }
            function convertCurrency() {
                hideError();
                const amount = parseFloat(amountInput.value);
                if (!amountInput.value || isNaN(amount) || amount < 0) {
                    resultElement.textContent = "0.00";
                    if (amount < 0) showError("金额不能为负数");
                    return;
                }
                if (Object.keys(exchangeRates).length === 0) { showError("汇率数据未加载"); return; }
                const rateFrom = exchangeRates[fromCurrency.value];
                const rateTo = exchangeRates[toCurrency.value];
                if (!rateFrom || !rateTo) { showError("所选货币汇率不可用"); return; }
                resultElement.textContent = ((amount / rateFrom) * rateTo).toFixed(2);
            }
            function swapCurrencies() {
                [fromCurrency.value, toCurrency.value] = [toCurrency.value, fromCurrency.value];
                if (amountInput.value) convertCurrency();
            }
            function showLoading(show) {
                loadingElement.style.display = show ? 'block' : 'none';
                convertBtn.disabled = refreshBtn.disabled = show;
            }
            function showError(message) { errorMessage.textContent = message; errorMessage.style.display = 'block'; }
            function hideError() { errorMessage.style.display = 'none'; }
            fetchExchangeRates();
            convertBtn.addEventListener('click', convertCurrency);
            refreshBtn.addEventListener('click', fetchExchangeRates);
            swapBtn.addEventListener('click', swapCurrencies);
            amountInput.addEventListener('input', () => { if (amountInput.value) convertCurrency() });

            // =================================================================
            // 费用计算器
            // =================================================================
            const totalAmountCostInput = document.getElementById('cost-calc-total-amount');
            const unitCostCostInput = document.getElementById('cost-calc-unit-cost');
            const timeUnitCostSelect = document.getElementById('cost-calc-time-unit');
            const startDateCostInput = document.getElementById('cost-calc-start-date');
            const calculateCostBtn = document.getElementById('cost-calc-button');
            const costResult = document.getElementById('cost-calc-result');

            calculateCostBtn.addEventListener('click', () => {
                const totalAmount = parseFloat(totalAmountCostInput.value);
                const unitCost = parseFloat(unitCostCostInput.value);
                const timeUnit = timeUnitCostSelect.value;
                const startDateStr = startDateCostInput.value;

                const showErrorInCost = (msg) => { costResult.innerHTML = `<div class="error">${msg}</div>`; };
                if (isNaN(totalAmount) || totalAmount <= 0) return showErrorInCost('请输入有效的总金额');
                if (isNaN(unitCost) || unitCost <= 0) return showErrorInCost('请输入有效的单位费用');

                let dailyCost;
                switch (timeUnit) {
                    case 'hour': dailyCost = unitCost * 24; break;
                    case 'day': dailyCost = unitCost; break;
                    case 'month': dailyCost = unitCost / 30; break;
                    case 'year': dailyCost = unitCost / 365.25; break;
                    default: dailyCost = 0;
                }

                if (dailyCost <= 0) return showErrorInCost('无法计算每日费用');

                const totalDays = Math.floor(totalAmount / dailyCost);
                const finalRemaining = totalAmount - (totalDays * dailyCost);

                const years = Math.floor(totalDays / 365);
                const remainingDaysAfterYears = totalDays % 365;
                const months = Math.floor(remainingDaysAfterYears / 30);
                const days = remainingDaysAfterYears % 30;
                
                let durationString = '';
                if (years > 0) durationString += `${years} 年 `;
                if (months > 0) durationString += `${months} 个月 `;
                if (days > 0 || durationString === '') durationString += `${days} 天`;
                
                let resultHTML = `
                    <h3>计算结果</h3>
                    <p>总金额 <strong>${totalAmount.toFixed(2)} 元</strong> 可使用：</p>
                    <p><span class="highlight">${durationString.trim()}</span> (约 ${totalDays} 天)</p>`;

                if (startDateStr) {
                    const startDate = new Date(startDateStr);
                    const endDate = new Date(startDate);
                    endDate.setDate(endDate.getDate() + totalDays);
                    resultHTML += `
                        <p>开始日期: <strong>${startDate.toLocaleDateString('zh-CN')}</strong></p>
                        <p>到期日期: <strong>${endDate.toLocaleDateString('zh-CN')}</strong></p>`;
                }

                resultHTML += `
                    <p>最终剩余: <strong>${finalRemaining.toFixed(2)} 元</strong></p>
                    <small>注：每月按30天，每年按365.25天估算。</small>`;

                costResult.innerHTML = resultHTML;
            });

            // =================================================================
            // 储蓄计算器
            // =================================================================
            let savingsVueInstance = null;
            
            function initSavingsCalculator() {
                savingsVueInstance = new Vue({
                    el: '#savings-calc-app',
                    data: {
                        currentMode: 'target', // target, amount, time
                        targetAmount: 50000,   // 填写默认值
                        monthlyDeposit: 2000,  // 填写默认值
                        initialAmount: 0,      // 填写默认值
                        timeValue: 12,         // 填写默认值
                        timeUnit: 'months',
                        frequency: 'monthly', // weekly, monthly, yearly
                        savingsChart: null
                    },
                    computed: {
                        // 计算总月数
                        totalMonths() {
                            if (this.timeUnit === 'years') {
                                return this.timeValue * 12;
                            }
                            return this.timeValue;
                        },
                        
                        // 目标模式：计算每月需要存款金额
                        requiredMonthlyDeposit() {
                            // 确保总月数大于0
                            if (this.totalMonths <= 0 || this.targetAmount <= this.initialAmount) return 0;
                            // 确保目标金额大于初始金额
                            if (this.targetAmount <= this.initialAmount) return 0;
                            
                            return (this.targetAmount - this.initialAmount) / this.totalMonths;
                        },
                        
                        // 总额模式：计算到期总金额
                        totalAmount() {
                            return this.initialAmount + (this.monthlyDeposit * this.totalMonths);
                        },
                        
                        // 时间模式：计算需要存款月数
                        requiredMonths() {
                            if (this.monthlyDeposit <= 0) return 0;
                            // 确保目标金额大于初始金额
                            if (this.targetAmount <= this.initialAmount) return 0;

                            return Math.ceil((this.targetAmount - this.initialAmount) / this.monthlyDeposit);
                        },
                        
                        // 根据频率计算每次存款金额
                        frequencyAmount() {
                            if (this.requiredMonthlyDeposit === 0) return 0;
                            if (this.frequency === 'weekly') {
                                return this.requiredMonthlyDeposit / 4.33; // 近似按每月4.33周
                            } else if (this.frequency === 'yearly') {
                                return this.requiredMonthlyDeposit * 12;
                            }
                            return this.requiredMonthlyDeposit;
                        },
                        
                        // 计算进度百分比
                        progressPercentage() {
                            if (this.currentMode === 'target' || this.currentMode === 'time') {
                                if (this.targetAmount <= 0) return 0;
                                return Math.min(100, Math.round((this.initialAmount / this.targetAmount) * 100));
                            }
                            // 'amount' 模式计算的是预期总额，用目标金额（默认为50000）作为参考，或只显示初始金额占比
                            if (this.targetAmount > 0) {
                                return Math.min(100, Math.round((this.initialAmount / this.targetAmount) * 100));
                            }
                            return 0; // 默认不显示进度条
                        },
                        
                        // 频率文本显示
                        frequencyText() {
                            const texts = {
                                'weekly': '每周',
                                'monthly': '每月',
                                'yearly': '每年'
                            };
                            return texts[this.frequency];
                        },
                        
                        // 生成储蓄进度数据
                        savingsData() {
                            const data = [];
                            let currentAmount = this.initialAmount;
                            let totalPeriods = 0;
                            let monthlyEquivalentDeposit = 0;
                            
                            // 确定计算周期和每月等效存款
                            if (this.currentMode === 'target') {
                                totalPeriods = this.totalMonths;
                                monthlyEquivalentDeposit = this.requiredMonthlyDeposit;
                            } 
                            else if (this.currentMode === 'amount') {
                                totalPeriods = this.totalMonths;
                                monthlyEquivalentDeposit = this.monthlyDeposit;
                            } 
                            else { // time模式
                                totalPeriods = this.requiredMonths;
                                monthlyEquivalentDeposit = this.monthlyDeposit;
                            }
                            
                            // 生成图表数据 (以月为单位)
                            for (let i = 0; i <= totalPeriods; i++) {
                                data.push({
                                    month: i,
                                    amount: currentAmount
                                });
                                currentAmount += monthlyEquivalentDeposit;
                            }

                            // 确保最后一个点达到目标金额 (仅对 target 和 time 模式)
                            if (this.currentMode !== 'amount' && data.length > 0) {
                                data[data.length - 1].amount = this.targetAmount;
                            }
                            
                            return data;
                        }
                    },
                    watch: {
                        // 当数据变化时更新图表
                        savingsData: {
                            handler(newData) {
                                this.updateChart(newData);
                            },
                            deep: true
                        },
                        currentMode(newMode, oldMode) {
                             // 切换模式时，重置时间单位和时间值，以匹配新模式的默认逻辑
                            if (newMode !== oldMode) {
                                if (newMode === 'target' || newMode === 'amount') {
                                    this.timeUnit = 'months';
                                    this.timeValue = 12; // 默认12个月/1年
                                }
                                // time模式不需要 timeValue/timeUnit
                            }
                        }
                    },
                    mounted() {
                        // 初始化图表
                        this.initChart();
                    },
                    methods: {
                        // 格式化货币显示
                        formatCurrency(value) {
                            if (isNaN(value) || value === 0) return '¥0';
                            return '¥' + value.toLocaleString('zh-CN', {
                                maximumFractionDigits: 2
                            });
                        },
                        
                        // 初始化图表
                        initChart() {
                            const ctx = document.getElementById('savingsChart').getContext('2d');
                            this.savingsChart = new Chart(ctx, {
                                type: 'line', // 使用折线图更适合显示累积趋势
                                data: {
                                    labels: this.savingsData.map(d => `第${d.month}月`),
                                    datasets: [{
                                        label: '储蓄金额',
                                        data: this.savingsData.map(d => d.amount),
                                        backgroundColor: 'rgba(67, 97, 238, 0.2)',
                                        borderColor: 'rgba(67, 97, 238, 1)',
                                        borderWidth: 2,
                                        fill: true,
                                        tension: 0.3,
                                        pointRadius: 3
                                    }]
                                },
                                options: {
                                    responsive: true,
                                    maintainAspectRatio: false,
                                    scales: {
                                        y: {
                                            beginAtZero: true,
                                            title: {
                                                display: true,
                                                text: '金额 (元)'
                                            },
                                            ticks: {
                                                callback: function(value) {
                                                    return '¥' + value.toLocaleString('zh-CN', {
                                                        maximumFractionDigits: 0
                                                    });
                                                }
                                            }
                                        },
                                        x: {
                                            title: {
                                                display: true,
                                                text: '时间 (月)'
                                            },
                                            ticks: {
                                                maxTicksLimit: 12
                                            }
                                        }
                                    },
                                    plugins: {
                                        legend: {
                                            display: false
                                        },
                                        tooltip: {
                                            callbacks: {
                                                label: function(context) {
                                                    return '储蓄金额: ¥' + context.parsed.y.toLocaleString('zh-CN', {
                                                        maximumFractionDigits: 2
                                                    });
                                                }
                                            }
                                        }
                                    }
                                }
                            });
                        },
                        
                        // 更新图表数据
                        updateChart(data) {
                            if (this.savingsChart) {
                                this.savingsChart.data.labels = data.map(d => `第${d.month}月`);
                                this.savingsChart.data.datasets[0].data = data.map(d => d.amount);
                                this.savingsChart.update();
                            }
                        }
                    }
                });
            }
            
            // 初始化储蓄计算器
            initSavingsCalculator();
        });
    </script>
</body>
</html>
